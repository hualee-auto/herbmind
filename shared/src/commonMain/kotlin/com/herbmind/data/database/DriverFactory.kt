package com.herbmind.data.database

import app.cash.sqldelight.db.SqlDriver
import com.herbmind.data.HerbDatabase
import kotlinx.serialization.builtins.ListSerializer
import kotlinx.serialization.builtins.serializer
import kotlinx.serialization.json.Json

expect class DriverFactory {
    fun createDriver(): SqlDriver
}

fun createDatabase(driverFactory: DriverFactory): HerbDatabase {
    val driver = driverFactory.createDriver()
    val database = HerbDatabase(driver)
    
    // 初始化数据（如果数据库为空）
    initializeData(database)
    
    return database
}

private fun initializeData(database: HerbDatabase) {
    val json = Json { ignoreUnknownKeys = true }
    
    // 检查是否已有数据
    val count = database.herbQueries.selectAll().executeAsList().size
    if (count > 0) return
    
    // 插入示例中药数据
    val herbs = listOf(
        HerbData(
            id = "danggui",
            name = "当归",
            pinyin = "danggui",
            aliases = listOf("干归", "秦归"),
            category = "补血药",
            subCategory = "补血",
            nature = "甘、辛，温",
            flavor = listOf("甘", "辛"),
            meridians = listOf("肝", "心", "脾"),
            effects = listOf("补血活血", "调经止痛", "润肠通便"),
            indications = listOf("血虚萎黄", "月经不调", "痛经", "血虚便秘"),
            memoryTip = "女人要归家，补血调经它",
            association = "像\"回家\"一样，给女性带来温暖",
            keyPoint = "妇科圣药",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 5
        ),
        HerbData(
            id = "huangqi",
            name = "黄芪",
            pinyin = "huangqi",
            aliases = listOf("黄耆", "绵芪"),
            category = "补气药",
            subCategory = "补气",
            nature = "甘，微温",
            flavor = listOf("甘"),
            meridians = listOf("脾", "肺"),
            effects = listOf("补气升阳", "益卫固表", "利水消肿", "托毒生肌"),
            indications = listOf("气虚乏力", "自汗", "水肿", "痈疽难溃"),
            memoryTip = "黄袍加身气很足，补气升阳最突出",
            association = "像黄色能量棒，补充全身气力",
            keyPoint = "补气诸药之最",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 5
        ),
        HerbData(
            id = "jinyinhua",
            name = "金银花",
            pinyin = "jinyinhua",
            aliases = listOf("忍冬", "双花"),
            category = "清热药",
            subCategory = "清热解毒",
            nature = "甘，寒",
            flavor = listOf("甘"),
            meridians = listOf("肺", "心", "胃"),
            effects = listOf("清热解毒", "疏散风热", "凉血止痢"),
            indications = listOf("痈肿疔疮", "外感风热", "温病初起", "热毒血痢"),
            memoryTip = "金银花开清热解毒，疮疡肿毒都怕它",
            association = "像金银财宝，珍贵且能解毒",
            keyPoint = "疮家圣药",
            similarTo = listOf("liangqiao"),
            isCommon = true,
            examFrequency = 4
        ),
        HerbData(
            id = "liangqiao",
            name = "连翘",
            pinyin = "lianqiao",
            aliases = listOf("连壳", "青翘"),
            category = "清热药",
            subCategory = "清热解毒",
            nature = "苦，微寒",
            flavor = listOf("苦"),
            meridians = listOf("肺", "心"),
            effects = listOf("清热解毒", "消肿散结", "疏散风热"),
            indications = listOf("痈疽", "瘰疬", "外感风热", "温病初起"),
            memoryTip = "连翘翘起来，解毒散结快",
            association = "像翘起的尾巴，能把毒素都翘走",
            keyPoint = "疮家圣药",
            similarTo = listOf("jinyinhua"),
            isCommon = true,
            examFrequency = 4
        ),
        HerbData(
            id = "renshen",
            name = "人参",
            pinyin = "renshen",
            aliases = listOf("人衔", "鬼盖"),
            category = "补气药",
            subCategory = "补气",
            nature = "甘、微苦，微温",
            flavor = listOf("甘", "微苦"),
            meridians = listOf("脾", "肺", "心"),
            effects = listOf("大补元气", "复脉固脱", "补脾益肺", "生津养血", "安神益智"),
            indications = listOf("气虚欲脱", "脉微欲绝", "脾虚食少", "肺虚喘咳"),
            memoryTip = "人生需要大补，元气充足",
            association = "像人生加油站，补充一切能量",
            keyPoint = "补气第一要药",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 5
        ),
        HerbData(
            id = "gancao",
            name = "甘草",
            pinyin = "gancao",
            aliases = listOf("国老", "甜草"),
            category = "补气药",
            subCategory = "补气",
            nature = "甘，平",
            flavor = listOf("甘"),
            meridians = listOf("心", "肺", "脾", "胃"),
            effects = listOf("补脾益气", "清热解毒", "祛痰止咳", "缓急止痛", "调和诸药"),
            indications = listOf("脾胃虚弱", "咳嗽痰多", "脘腹疼痛", "药物中毒"),
            memoryTip = "甘草甜如蜜，调和百药效",
            association = "像和事佬，协调各方药材",
            keyPoint = "国老",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 5
        ),
        HerbData(
            id = "chuanxiong",
            name = "川芎",
            pinyin = "chuanxiong",
            aliases = listOf("芎穷"),
            category = "活血化瘀药",
            subCategory = "活血",
            nature = "辛，温",
            flavor = listOf("辛"),
            meridians = listOf("肝", "胆", "心包"),
            effects = listOf("活血行气", "祛风止痛"),
            indications = listOf("胸痹心痛", "痛经", "闭经", "头痛", "风湿痹痛"),
            memoryTip = "川芎上行头目，下行血海",
            association = "像快递小哥，到处送血气",
            keyPoint = "血中之气药",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 4
        ),
        HerbData(
            id = "baishao",
            name = "白芍",
            pinyin = "baishao",
            aliases = listOf("白芍药"),
            category = "补血药",
            subCategory = "补血",
            nature = "苦、酸，微寒",
            flavor = listOf("苦", "酸"),
            meridians = listOf("肝", "脾"),
            effects = listOf("养血调经", "敛阴止汗", "柔肝止痛", "平抑肝阳"),
            indications = listOf("血虚萎黄", "月经不调", "自汗盗汗", "胁痛腹痛"),
            memoryTip = "白芍柔肝又养血，止痛敛阴效果好",
            association = "像温柔的白衣天使，安抚肝经",
            keyPoint = "柔肝止痛",
            similarTo = listOf("baizhu"),
            isCommon = true,
            examFrequency = 4
        ),
        HerbData(
            id = "baizhu",
            name = "白术",
            pinyin = "baizhu",
            aliases = listOf("于术", "冬术"),
            category = "补气药",
            subCategory = "补气",
            nature = "苦、甘，温",
            flavor = listOf("苦", "甘"),
            meridians = listOf("脾", "胃"),
            effects = listOf("健脾益气", "燥湿利水", "止汗", "安胎"),
            indications = listOf("脾虚食少", "腹胀泄泻", "痰饮眩悸", "胎动不安"),
            memoryTip = "白术健脾燥湿，脾气虚弱首选",
            association = "像土壤改良剂，让脾胃更健康",
            keyPoint = "健脾第一要药",
            similarTo = listOf("baishao"),
            isCommon = true,
            examFrequency = 4
        ),
        HerbData(
            id = "shengdi",
            name = "生地黄",
            pinyin = "shengdihuang",
            aliases = listOf("生地", "干地黄"),
            category = "清热药",
            subCategory = "清热凉血",
            nature = "甘，寒",
            flavor = listOf("甘"),
            meridians = listOf("心", "肝", "肾"),
            effects = listOf("清热凉血", "养阴生津"),
            indications = listOf("热入营血", "温毒发斑", "吐血衄血", "阴虚内热"),
            memoryTip = "生地清热又养阴，血热阴虚都能治",
            association = "像天然的冷却液，降温又滋润",
            keyPoint = "清热凉血要药",
            similarTo = listOf("shoudi"),
            isCommon = true,
            examFrequency = 4
        ),
        // 清热药 - 清热燥湿
        HerbData(
            id = "huanglian",
            name = "黄连",
            pinyin = "huanglian",
            aliases = listOf("味连", "雅连"),
            category = "清热药",
            subCategory = "清热燥湿",
            nature = "苦，寒",
            flavor = listOf("苦"),
            meridians = listOf("心", "脾", "胃", "肝", "胆"),
            effects = listOf("清热燥湿", "泻火解毒"),
            indications = listOf("湿热痞满", "呕吐吞酸", "泻痢", "黄疸", "高热神昏"),
            memoryTip = "黄连苦口良药，清热燥湿泻火强",
            association = "像苦口的良药，清热力量最强",
            keyPoint = "清热燥湿首选",
            similarTo = listOf("huangqin", "huangbai"),
            isCommon = true,
            examFrequency = 5
        ),
        HerbData(
            id = "huangqin",
            name = "黄芩",
            pinyin = "huangqin",
            aliases = listOf("腐肠", "空肠"),
            category = "清热药",
            subCategory = "清热燥湿",
            nature = "苦，寒",
            flavor = listOf("苦"),
            meridians = listOf("肺", "胆", "脾", "大肠", "小肠"),
            effects = listOf("清热燥湿", "泻火解毒", "止血", "安胎"),
            indications = listOf("湿温暑湿", "胸闷呕恶", "肺热咳嗽", "血热出血"),
            memoryTip = "黄芩上焦肺，清热安胎止血奇",
            association = "像天空的屏障，保护上焦",
            keyPoint = "上焦热证要药",
            similarTo = listOf("huanglian", "huangbai"),
            isCommon = true,
            examFrequency = 4
        ),
        HerbData(
            id = "huangbai",
            name = "黄柏",
            pinyin = "huangbai",
            aliases = listOf("檗木", "黄檗"),
            category = "清热药",
            subCategory = "清热燥湿",
            nature = "苦，寒",
            flavor = listOf("苦"),
            meridians = listOf("肾", "膀胱"),
            effects = listOf("清热燥湿", "泻火除蒸", "解毒疗疮"),
            indications = listOf("湿热下注", "带下黄浊", "热淋涩痛", "骨蒸劳热"),
            memoryTip = "黄柏下焦肾，清热除蒸效果好",
            association = "像地下的树根，专走下焦",
            keyPoint = "下焦湿热要药",
            similarTo = listOf("huanglian", "huangqin"),
            isCommon = true,
            examFrequency = 4
        ),
        // 清热药 - 清热泻火
        HerbData(
            id = "zhizi",
            name = "栀子",
            pinyin = "zhizi",
            aliases = listOf("木丹", "越桃"),
            category = "清热药",
            subCategory = "清热泻火",
            nature = "苦，寒",
            flavor = listOf("苦"),
            meridians = listOf("心", "肺", "三焦"),
            effects = listOf("泻火除烦", "清热利湿", "凉血解毒"),
            indications = listOf("热病心烦", "湿热黄疸", "淋证涩痛", "血热出血"),
            memoryTip = "栀子泻火除烦，三焦热毒都管",
            association = "像清道夫，清理三焦的热毒",
            keyPoint = "泻火除烦要药",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 4
        ),
        // 活血化瘀药
        HerbData(
            id = "danshen",
            name = "丹参",
            pinyin = "danshen",
            aliases = listOf("赤参", "紫丹参"),
            category = "活血化瘀药",
            subCategory = "活血",
            nature = "苦，微寒",
            flavor = listOf("苦"),
            meridians = listOf("心", "肝"),
            effects = listOf("活血祛瘀", "通经止痛", "清心除烦", "凉血消痈"),
            indications = listOf("胸痹心痛", "脘腹胁痛", "癥瘕积聚", "热痹疼痛"),
            memoryTip = "丹心一片活心血，祛瘀止痛效果好",
            association = "像红色的心脏守护者",
            keyPoint = "活血化瘀要药",
            similarTo = listOf("chuanxiong"),
            isCommon = true,
            examFrequency = 5
        ),
        HerbData(
            id = "honghua",
            name = "红花",
            pinyin = "honghua",
            aliases = listOf("红蓝花", "刺红花"),
            category = "活血化瘀药",
            subCategory = "活血",
            nature = "辛，温",
            flavor = listOf("辛"),
            meridians = listOf("心", "肝"),
            effects = listOf("活血通经", "散瘀止痛"),
            indications = listOf("经闭", "痛经", "恶露不行", "癥瘕痞块"),
            memoryTip = "红花红艳艳，活血通经专",
            association = "像红色的河流，让血液流动更顺畅",
            keyPoint = "活血通经专药",
            similarTo = listOf("taoren"),
            isCommon = true,
            examFrequency = 4
        ),
        HerbData(
            id = "taoren",
            name = "桃仁",
            pinyin = "taoren",
            aliases = listOf("桃核仁"),
            category = "活血化瘀药",
            subCategory = "活血",
            nature = "苦、甘，平",
            flavor = listOf("苦", "甘"),
            meridians = listOf("心", "肝", "大肠"),
            effects = listOf("活血祛瘀", "润肠通便", "止咳平喘"),
            indications = listOf("经闭痛经", "癥瘕痞块", "肺痈肠痈", "肠燥便秘"),
            memoryTip = "桃仁祛瘀润肠，双管齐下强",
            association = "像桃子的核心，专破瘀血",
            keyPoint = "祛瘀润肠双效",
            similarTo = listOf("honghua"),
            isCommon = true,
            examFrequency = 4
        ),
        // 解表药 - 发散风寒
        HerbData(
            id = "mahuang",
            name = "麻黄",
            pinyin = "mahuang",
            aliases = listOf("龙沙", "卑相"),
            category = "解表药",
            subCategory = "发散风寒",
            nature = "辛、微苦，温",
            flavor = listOf("辛", "微苦"),
            meridians = listOf("肺", "膀胱"),
            effects = listOf("发汗解表", "宣肺平喘", "利水消肿"),
            indications = listOf("风寒感冒", "胸闷喘咳", "风水浮肿"),
            memoryTip = "麻黄发汗强，宣肺平喘忙",
            association = "像打开窗户，让汗和气都出去",
            keyPoint = "发汗解表第一药",
            similarTo = listOf("guizhi"),
            isCommon = true,
            examFrequency = 5
        ),
        HerbData(
            id = "guizhi",
            name = "桂枝",
            pinyin = "guizhi",
            aliases = listOf("柳桂"),
            category = "解表药",
            subCategory = "发散风寒",
            nature = "辛、甘，温",
            flavor = listOf("辛", "甘"),
            meridians = listOf("心", "肺", "膀胱"),
            effects = listOf("发汗解肌", "温通经脉", "助阳化气"),
            indications = listOf("风寒感冒", "脘腹冷痛", "血寒经闭", "痰饮水肿"),
            memoryTip = "桂枝温通经脉，助阳化气行",
            association = "像温暖的枝条，通达全身",
            keyPoint = "温通经脉要药",
            similarTo = listOf("mahuang"),
            isCommon = true,
            examFrequency = 5
        ),
        // 解表药 - 发散风热
        HerbData(
            id = "chaihu",
            name = "柴胡",
            pinyin = "chaihu",
            aliases = listOf("地薰", "山菜"),
            category = "解表药",
            subCategory = "发散风热",
            nature = "辛、苦，微寒",
            flavor = listOf("辛", "苦"),
            meridians = listOf("肝", "胆", "肺"),
            effects = listOf("疏散退热", "疏肝解郁", "升举阳气"),
            indications = listOf("感冒发热", "寒热往来", "胸胁胀痛", "月经不调"),
            memoryTip = "柴胡和解退热，疏肝升阳齐",
            association = "像升降机，能升能降调节气机",
            keyPoint = "和解少阳要药",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 5
        ),
        HerbData(
            id = "gegen",
            name = "葛根",
            pinyin = "gegen",
            aliases = listOf("甘葛", "鹿藿"),
            category = "解表药",
            subCategory = "发散风热",
            nature = "甘、辛，凉",
            flavor = listOf("甘", "辛"),
            meridians = listOf("脾", "胃"),
            effects = listOf("解肌退热", "生津止渴", "透疹", "升阳止泻"),
            indications = listOf("外感发热", "项背强痛", "口渴", "麻疹不透"),
            memoryTip = "葛根解肌退热，生津止渴齐",
            association = "像藤蔓一样，把热从肌肉拉出去",
            keyPoint = "解肌退热要药",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 4
        ),
        // 祛湿药 - 利水渗湿
        HerbData(
            id = "fuling",
            name = "茯苓",
            pinyin = "fuling",
            aliases = listOf("茯灵", "云苓"),
            category = "祛湿药",
            subCategory = "利水渗湿",
            nature = "甘、淡，平",
            flavor = listOf("甘", "淡"),
            meridians = listOf("心", "肺", "脾", "肾"),
            effects = listOf("利水渗湿", "健脾", "宁心"),
            indications = listOf("水肿尿少", "痰饮眩悸", "脾虚食少", "心神不安"),
            memoryTip = "茯苓利水健脾，宁心安神齐",
            association = "像海绵，吸走多余的水分",
            keyPoint = "利水渗湿要药",
            similarTo = listOf("yiyiren"),
            isCommon = true,
            examFrequency = 5
        ),
        HerbData(
            id = "yiyiren",
            name = "薏苡仁",
            pinyin = "yiyiren",
            aliases = listOf("薏米", "苡仁"),
            category = "祛湿药",
            subCategory = "利水渗湿",
            nature = "甘、淡，凉",
            flavor = listOf("甘", "淡"),
            meridians = listOf("脾", "胃", "肺"),
            effects = listOf("利水渗湿", "健脾止泻", "除痹", "排脓"),
            indications = listOf("水肿", "脚气", "脾虚泄泻", "肺痈肠痈"),
            memoryTip = "薏米健脾利湿，排脓除痹齐",
            association = "像白色的珍珠，养脾胃去湿气",
            keyPoint = "健脾利湿佳品",
            similarTo = listOf("fuling"),
            isCommon = true,
            examFrequency = 4
        ),
        // 理气药
        HerbData(
            id = "chenpi",
            name = "陈皮",
            pinyin = "chenpi",
            aliases = listOf("橘皮", "贵老"),
            category = "理气药",
            subCategory = "理气",
            nature = "苦、辛，温",
            flavor = listOf("苦", "辛"),
            meridians = listOf("脾", "肺"),
            effects = listOf("理气健脾", "燥湿化痰"),
            indications = listOf("脘腹胀满", "食少吐泻", "咳嗽痰多"),
            memoryTip = "陈皮理气健脾，燥湿化痰齐",
            association = "像陈年的好酒，越陈越香越有效",
            keyPoint = "理气健脾要药",
            similarTo = listOf("xiangfu"),
            isCommon = true,
            examFrequency = 4
        ),
        HerbData(
            id = "xiangfu",
            name = "香附",
            pinyin = "xiangfu",
            aliases = listOf("雀头香", "莎草根"),
            category = "理气药",
            subCategory = "理气",
            nature = "辛、微苦、微甘，平",
            flavor = listOf("辛", "微苦", "微甘"),
            meridians = listOf("肝", "脾", "三焦"),
            effects = listOf("疏肝解郁", "理气宽中", "调经止痛"),
            indications = listOf("肝郁气滞", "胸胁胀痛", "脾胃气滞", "月经不调"),
            memoryTip = "香附疏肝理气，调经止痛奇",
            association = "像香气的使者，疏通气机的堵塞",
            keyPoint = "气病之总司",
            similarTo = listOf("chenpi"),
            isCommon = true,
            examFrequency = 4
        ),
        // 安神药
        HerbData(
            id = "suanzaoren",
            name = "酸枣仁",
            pinyin = "suanzaoren",
            aliases = listOf("枣仁", "酸枣核"),
            category = "安神药",
            subCategory = "养心安神",
            nature = "甘、酸，平",
            flavor = listOf("甘", "酸"),
            meridians = listOf("肝", "胆", "心"),
            effects = listOf("养心益肝", "安神", "敛汗"),
            indications = listOf("虚烦不眠", "惊悸多梦", "体虚多汗"),
            memoryTip = "酸枣仁养心肝，安神敛汗专",
            association = "像红色的小枕头，让人安睡",
            keyPoint = "养心安神要药",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 4
        ),
        // 补虚药 - 补阳
        HerbData(
            id = "fuzi",
            name = "附子",
            pinyin = "fuzi",
            aliases = listOf("附片", "川附子"),
            category = "补虚药",
            subCategory = "补阳",
            nature = "辛、甘，大热；有毒",
            flavor = listOf("辛", "甘"),
            meridians = listOf("心", "肾", "脾"),
            effects = listOf("回阳救逆", "补火助阳", "散寒止痛"),
            indications = listOf("亡阳虚脱", "肢冷脉微", "心阳不足", "脘腹冷痛"),
            memoryTip = "附子回阳救逆，补火助阳强",
            association = "像火源，点燃身体的阳气",
            keyPoint = "回阳救逆第一药",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 5,
            contraindications = listOf("孕妇禁用", "不宜与半夏同用")
        ),
        // 补虚药 - 补血
        HerbData(
            id = "shoudihuang",
            name = "熟地黄",
            pinyin = "shoudihuang",
            aliases = listOf("熟地"),
            category = "补虚药",
            subCategory = "补血",
            nature = "甘，微温",
            flavor = listOf("甘"),
            meridians = listOf("肝", "肾"),
            effects = listOf("补血滋阴", "益精填髓"),
            indications = listOf("血虚萎黄", "心悸怔忡", "月经不调", "肝肾阴虚"),
            memoryTip = "熟地补血滋阴，益精填髓强",
            association = "像黑色的营养库，补充精血",
            keyPoint = "补血滋阴要药",
            similarTo = listOf("shengdi"),
            isCommon = true,
            examFrequency = 5
        ),
        // 止咳平喘药
        HerbData(
            id = "xingren",
            name = "苦杏仁",
            pinyin = "kuxingren",
            aliases = listOf("杏仁", "北杏仁"),
            category = "止咳平喘药",
            subCategory = "止咳平喘",
            nature = "苦，微温；有小毒",
            flavor = listOf("苦"),
            meridians = listOf("肺", "大肠"),
            effects = listOf("降气止咳平喘", "润肠通便"),
            indications = listOf("咳嗽气喘", "胸满痰多", "肠燥便秘"),
            memoryTip = "杏仁降气止咳，润肠通便齐",
            association = "像小伞，把肺气降下来",
            keyPoint = "止咳平喘要药",
            similarTo = emptyList(),
            isCommon = true,
            examFrequency = 4
        ),
        // 其他常用药
        HerbData(
            id = "dangshen",
            name = "党参",
            pinyin = "dangshen",
            aliases = listOf("上党人参", "黄参"),
            category = "补虚药",
            subCategory = "补气",
            nature = "甘，平",
            flavor = listOf("甘"),
            meridians = listOf("脾", "肺"),
            effects = listOf("健脾益肺", "养血生津"),
            indications = listOf("脾肺气虚", "食少倦怠", "咳嗽虚喘", "气血不足"),
            memoryTip = "党参补中益气，养血生津齐",
            association = "像人参的兄弟，补气更温和",
            keyPoint = "补中益气常用药",
            similarTo = listOf("renshen", "huangqi"),
            isCommon = true,
            examFrequency = 4
        ),
        HerbData(
            id = "mudanpi",
            name = "牡丹皮",
            pinyin = "mudanpi",
            aliases = listOf("丹皮", "粉丹皮"),
            category = "清热药",
            subCategory = "清热凉血",
            nature = "苦、辛，微寒",
            flavor = listOf("苦", "辛"),
            meridians = listOf("心", "肝", "肾"),
            effects = listOf("清热凉血", "活血化瘀"),
            indications = listOf("热入营血", "温毒发斑", "吐血衄血", "经闭痛经"),
            memoryTip = "丹皮清热凉血，活血化瘀齐",
            association = "像牡丹的花瓣，美丽又能凉血",
            keyPoint = "清热凉血活血",
            similarTo = listOf("shengdi"),
            isCommon = true,
            examFrequency = 4
        )
    )
    
    herbs.forEach { herb ->
        database.herbQueries.insertHerb(
            id = herb.id,
            name = herb.name,
            pinyin = herb.pinyin,
            aliases = json.encodeToString(ListSerializer(String.serializer()), herb.aliases),
            category = herb.category,
            subCategory = herb.subCategory,
            nature = herb.nature,
            flavor = json.encodeToString(ListSerializer(String.serializer()), herb.flavor),
            meridians = json.encodeToString(ListSerializer(String.serializer()), herb.meridians),
            effects = json.encodeToString(ListSerializer(String.serializer()), herb.effects),
            indications = json.encodeToString(ListSerializer(String.serializer()), herb.indications),
            usage = null,
            contraindications = json.encodeToString(ListSerializer(String.serializer()), herb.contraindications),
            memoryTip = herb.memoryTip,
            association = herb.association,
            keyPoint = herb.keyPoint,
            similarTo = json.encodeToString(ListSerializer(String.serializer()), herb.similarTo),
            image = null,
            isCommon = if (herb.isCommon) 1L else 0L,
            examFrequency = herb.examFrequency.toLong()
        )
    }
}

private data class HerbData(
    val id: String,
    val name: String,
    val pinyin: String,
    val aliases: List<String>,
    val category: String,
    val subCategory: String?,
    val nature: String?,
    val flavor: List<String>,
    val meridians: List<String>,
    val effects: List<String>,
    val indications: List<String>,
    val memoryTip: String?,
    val association: String?,
    val keyPoint: String?,
    val similarTo: List<String>,
    val isCommon: Boolean,
    val examFrequency: Int,
    val contraindications: List<String> = emptyList()
)